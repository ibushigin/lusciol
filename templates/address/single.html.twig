{% extends 'base.html.twig' %}

{% block title %}{% endblock %}

{% block body %}

    {#DIV pour OSM#}
    <div id="map"></div>

    <p>

Latitude : {{ lat }} ,Longitude: {{ long }}


    </p>


    {% for item in address %}
        <article>

            {#{{ dump(item) }}#}
            <strong>Nom :</strong> {{ item.name }}<br>
            <strong>Sous-Categorie :</strong> {{ item.subCategory.label }}<br>
            <strong>Categorie :</strong> {{ item.subCategory.category.label }}<br>
            <strong>Adresse :</strong> {{ item.location }}<br>
            <strong>Coordoonées géographiques :</strong> {{ item.coordinates }}<br>
            <strong>Tel :</strong> {{ item.tel }}<br>
            <strong>Site internet :</strong> {{ item.website }}<br>
            <strong>Réduction :</strong> {{ item.discount }}<br>
            <strong>Statut :</strong> {{ item.status }}<br>

        </article>

    {% endfor %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {#<script src="{{ asset('js/map.js') }}"></script>#}

    <script>
        $(function() {
            let osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                osmAttrib = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                osm = L.tileLayer(osmUrl, {maxZoom: 18, attribution: osmAttrib});
            let map = L.map('map').setView([44.8397534, -0.5739364], 14);

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox.streets',
                accessToken: 'pk.eyJ1IjoiaWJ1c2hpZ2luIiwiYSI6ImNqcXJ1d3lwdjBnZXo0MmxqZWRyMGIzdmEifQ.MAtmFHO16MD5osbZotlXYw'
            }).addTo(map);


            map.locate({setView: true, maxZoom: 16});
            function onLocationFound(e) {
                var radius = e.accuracy / 4;

                // L.marker(e.latlng).addTo(map);


                L.circle(e.latlng, radius).addTo(map);
            }

            map.on('locationfound', onLocationFound);

            var lat = '{{lat}}';
            var long = '{{long}}';


            var marker = L.marker([lat, long]).addTo(map);


            marker.on('click', function () {
                marker.bindPopup('NTM').openPopup;

            })

        })








    </script>
{% endblock %}
